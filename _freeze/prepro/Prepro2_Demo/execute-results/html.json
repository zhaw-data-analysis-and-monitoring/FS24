{
  "hash": "6a2191217751df76fc5a32ebc1bc4b10",
  "result": {
    "markdown": "---\ndate: 2023-10-16\nlesson: PrePro2\nthema: Piping / Joins\nindex: 1\nknitr:\n  opts_chunk: \n    collapse: true\n---\n\n\n# Prepro 2: Demo\n\nDiese Demo kann auch als [R Script heruntergeladen werden](Prepro2_Demo.R) (Rechtsklick → *Save Target As..*)\n\n## Piping\n\nGegeben ist ein character string (`diary`). Wir wollen aus diesem Text die Temperaturangabe aus dem String extrahieren und danach den Wert von Kelvin in Celsius nach der folgenden Formel umwandeln und zum Schluss den Mittelwert über all diese Werte berechnen.\n\n$$°C = K - 273.15$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiary <- c(\n  \"The temperature is 310° Kelvin\",\n  \"The temperature is 322° Kelvin\",\n  \"The temperature is 410° Kelvin\"\n)\n\ndiary\n## [1] \"The temperature is 310° Kelvin\" \"The temperature is 322° Kelvin\"\n## [3] \"The temperature is 410° Kelvin\"\n```\n:::\n\n\nDazu brauchen wir die Funktion `substr()`, welche aus einem `character` einen Teil \"raus schnipseln\" kann.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Wenn die Buchstaben einzelne _Elemente_ eines Vektors wären, würden wir diese\n# folgendermassen subsetten:\n\ncharvec1 <- c(\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\")\ncharvec1[4:6]\n## [1] \"d\" \"e\" \"f\"\n\n# Aber wenn diese in einem einzigen character gespeichert sind, brauchen wir substr:\ncharvec2 <- \"abcdefgh\"\nsubstr(charvec2, 4, 6)\n## [1] \"def\"\n```\n:::\n\n\nZudem nutzen haben wir eine Hilfsfunktion `subtrahieren`, welche zwei Werte annimmt, den `minuend` und den `subtrahend`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsubtrahieren <- function(minuend, subtrahend) {\n  minuend - subtrahend\n}\n\nsubtrahieren(10, 4)\n## [1] 6\n```\n:::\n\n\nÜbersetzt in `R`-Code entsteht folgende Operation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\noutput <- mean(subtrahieren(as.numeric(substr(diary, 20, 22)), 273.15))\n#                                             \\_1_/\n#                                      \\________2__________/\n#                           \\___________________3___________/\n#              \\________________________________4__________________/\n#         \\_____________________________________5____________________/\n\n# 1. Nimm diary\n# 2. Extrahiere auf jeder Zeile die Werte 20 bis 22\n# 3. Konvertiere \"character\" zu \"numeric\"\n# 4. Subtrahiere 273.15\n# 5. Berechne den Mittlwert\n```\n:::\n\n\nDie ganze Operation liest sich etwas leichter, wenn diese sequentiell notiert wird:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp <- substr(diary, 20, 22)      # 2\ntemp <- as.numeric(temp)           # 3\ntemp <- subtrahieren(temp, 273.15) # 4\noutput <- mean(temp)               # 5\n```\n:::\n\n\nUmständlich ist dabei einfach, dass die Zwischenresultate immer abgespeichert und in der darauf folgenden Operation wieder abgerufen werden müssen. Hier kommt \"piping\" ins Spiel: *Mit \"piping\" wird der Output der einen Funktion der erste Parameter der darauf folgenden Funktion.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndiary |>                  # 1\n  substr(20, 22) |>       # 2\n  as.numeric() |>         # 3\n  subtrahieren(273.15) |> # 4\n  mean()                  # 5\n## [1] 74.18333\n```\n:::\n\n\n:::{.callout-important}\n- der `|>` Pipe Operator wurde erst in R `4.1` eingeführt\n- Neben dem *base R* Pipe Operator existiert im Package `magrittr` ein sehr ähnlicher[^pipe] Pipe Operator: `%>%`\n- Die Tastenkombination <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>M</kbd> in RStudio fügt einen Pipe Operator ein. \n- Welcher Pipe Operator `|>` oder `%>%` mit der obigen Tastenkombination eingeführt wird, kann über die RStudio Settings `Tools` → `Global Options` → `Code` → Häckchen setzen bei `Use nativ pipe operator`\n- Wir empfehlen die base-R Pipe `|>` zu verwenden\n:::\n\n[^pipe]: siehe <https://stackoverflow.com/q/67633022/4139249>\n\n## Joins\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudierende <- data.frame(\n  Matrikel_Nr = c(100002, 100003, 200003),\n  Studi = c(\"Patrick\", \"Manuela\", \"Eva\"),\n  PLZ = c(8006, 8001, 8820)\n)\n\nstudierende\n##   Matrikel_Nr   Studi  PLZ\n## 1      100002 Patrick 8006\n## 2      100003 Manuela 8001\n## 3      200003     Eva 8820\n\nortschaften <- data.frame(\n  PLZ = c(8003, 8006, 8810, 8820),\n  Ortsname = c(\"Zürich\", \"Zürich\", \"Horgen\", \"Wädenswil\")\n)\n\nortschaften\n##    PLZ  Ortsname\n## 1 8003    Zürich\n## 2 8006    Zürich\n## 3 8810    Horgen\n## 4 8820 Wädenswil\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load library\nlibrary(\"dplyr\")\n\ninner_join(studierende, ortschaften, by = \"PLZ\")\n##   Matrikel_Nr   Studi  PLZ  Ortsname\n## 1      100002 Patrick 8006    Zürich\n## 2      200003     Eva 8820 Wädenswil\n\nleft_join(studierende, ortschaften, by = \"PLZ\")\n##   Matrikel_Nr   Studi  PLZ  Ortsname\n## 1      100002 Patrick 8006    Zürich\n## 2      100003 Manuela 8001      <NA>\n## 3      200003     Eva 8820 Wädenswil\n\nright_join(studierende, ortschaften, by = \"PLZ\")\n##   Matrikel_Nr   Studi  PLZ  Ortsname\n## 1      100002 Patrick 8006    Zürich\n## 2      200003     Eva 8820 Wädenswil\n## 3          NA    <NA> 8003    Zürich\n## 4          NA    <NA> 8810    Horgen\n\nfull_join(studierende, ortschaften, by = \"PLZ\")\n##   Matrikel_Nr   Studi  PLZ  Ortsname\n## 1      100002 Patrick 8006    Zürich\n## 2      100003 Manuela 8001      <NA>\n## 3      200003     Eva 8820 Wädenswil\n## 4          NA    <NA> 8003    Zürich\n## 5          NA    <NA> 8810    Horgen\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstudierende <- data.frame(\n  Matrikel_Nr = c(100002, 100003, 200003),\n  Studi = c(\"Patrick\", \"Manuela\", \"Pascal\"),\n  Wohnort = c(8006, 8001, 8006)\n)\n\nleft_join(studierende, ortschaften, by = c(\"Wohnort\" = \"PLZ\"))\n##   Matrikel_Nr   Studi Wohnort Ortsname\n## 1      100002 Patrick    8006   Zürich\n## 2      100003 Manuela    8001     <NA>\n## 3      200003  Pascal    8006   Zürich\n```\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}